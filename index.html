<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>TopMaxsulotMarket</title>
  <link rel="stylesheet" href="index.css">
  <link rel="icon" type="image/png" href="favicon.png">

  <style>
    /* === 1. KIRISH OYNASI STILI (DARVOZA) === */
    #login-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #ffffff; /* Oq fon */
        z-index: 9999; /* Hammasining ustida turadi */
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 20px;
    }

    #site-content {
        display: none; /* Sayt boshida YASHIRIN bo'ladi */
    }

    .google-btn {
        background-color: #4285F4;
        color: white;
        padding: 15px 30px;
        border: none;
        border-radius: 5px;
        font-size: 18px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        transition: 0.3s;
    }
    .google-btn:hover {
        background-color: #357ae8;
        transform: scale(1.05);
    }
    .loading-spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
        display: none; /* Boshida ko'rinmaydi */
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>

</head>

<body>

  <div id="login-screen">
      <img src="logo.png" alt="Logo" width="150" style="margin-bottom: 20px;">
      <h1>TopMaxsulotMarket</h1>
      <p>Davom etish uchun ro'yxatdan o'ting yoki kiring</p>
      
      <div id="loader" class="loading-spinner"></div>

      <button id="google-login-btn" class="google-btn">
        <svg width="20" height="20" viewBox="0 0 24 24">
            <path fill="white" d="M21.35,11.1H12v3.8h5.6c-0.5,2.1-2.4,3.5-5.6,3.5c-3.3,0-6-2.7-6-6s2.7-6,6-6c1.5,0,2.8,0.5,3.8,1.4l2.9-2.9 C16.9,2.4,14.6,1.4,12,1.4c-5.9,0-10.7,4.8-10.7,10.7S6.1,22.7,12,22.7c5.6,0,10.3-4,10.7-9.5c0-0.7-0.1-1.4-0.2-2.1L21.35,11.1z"/>
        </svg>
        Google orqali kirish
      </button>
  </div>

  <div id="site-content">
      
      <nav class="mobile-bottom-nav">
        <a href="index.html" class="nav-link active">
            <span class="nav-icon">üè†</span> 
            <span class="nav-text">Bosh sahifa</span>
        </a>
        <a href="katalog.html" class="nav-link">
            <span class="nav-icon">‚ò∞</span>
            <span class="nav-text">Katalog</span>
        </a>
        <a href="savat.html" class="nav-link">
            <span class="nav-icon">üõí</span>
            <span class="nav-text">Savat</span>
        </a>
        <a href="#" class="nav-link" id="mobile-logout-btn">
            <span class="nav-icon">üö™</span>
            <span class="nav-text">Chiqish</span>
        </a>
      </nav>

      <header> 
        <div class="logo"> 
          <img src="logo.png" alt="TopMaxsulotMarket Logotip" width="300"> 
        </div>
        <nav> 
          <ul> 
            <li><a href="index.html">üè† Bosh sahifa</a></li> 
            <li><a href="katalog.html">‚ò∞ Mahsulotlar katalogi</a></li> 
            <li><a href="savat.html">üõíSavat</a></li> 
            <li><a href="#" id="user-display-name">üë§ Kabinet</a></li>
            <li><a href="#" id="desktop-logout-btn" style="color: red;">Chiqish</a></li>
          </ul>
        </nav>
      </header>

      <section class="banner"> 
        <h1 id="welcome-text">TopMaxsulotMarketga xush kelibsiz!</h1> 
        <p>Eng yaxshi mahsulotlarni qulay narxlarda xarid qiling.</p> 
        <a href="katalog.html" class="btn">Xaridni boshlash</a> 
      </section>

      <section class="products"> 
        <h2>Ko‚Äòp sotilgan mahsulotlar</h2> 
        
        <div class="product-grid"> 
          <div class="product-card"> 
            <img src="https://www.pngplay.com/wp-content/uploads/12/Smartphone-PNG-Free-File-Download.png" alt="Telefon"> 
            <h3>Smartfon</h3> 
            <a href="telefon.html" class="btm">Mahsulotlarga o'tish</a>
          </div>

          <div class="product-card">
            <img src="https://i.dell.com/is/image/DellContent/content/dam/ss2/product-images/dell-client-products/notebooks/dell-plus/db16255/media-gallery/non-touch/laptop-dell-plus-db16255nt-ice-bl-fpr-gallery-5.psd?fmt=png-alpha&pscan=auto&scl=1&hei=804&wid=979&qlt=100,1&resMode=sharp2&size=979,804&chrss=full" alt="Laptop"> <br><br><br>
            <h3>Laptop</h3>
            <a href="noutbook.html" class="btm">Mahsulotlarga o'tish</a> 
          </div>


          <div class="product-card">
            <img src="https://www.doridarmon.uz/uploads/news/9043f59c5fa87d50d4d4906f4a71b364.jpg" alt="Smart soat">
            <h3>Poyabzallar</h3>
            <a href="poyabzallar.html" class="btm">Mahsulotlarga o'tish</a>
          </div>
          
        </div>
      </section>

      <a href="https://t.me/topmaxsulotmarket" class="telegram-float" target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="30" height="30" fill="white">
          <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 11.944 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
        </svg>
      </a>

      <footer>
        <p>&copy; 2025 TopMaxsulotMarket. Barcha huquqlar himoyalangan.</p>
      </footer>

  </div> <script>
    let cart = JSON.parse(localStorage.getItem('cart_v1')) || []; 
    document.querySelectorAll('.add-to-cart').forEach(btn=>{
      btn.addEventListener('click', function(e){
        e.preventDefault();
        const item = { id: this.dataset.id, title: this.dataset.title, img: this.dataset.img, price: Number(this.dataset.price), qty: 1 };
        let exist = cart.find(p => p.id === item.id);
        if (exist) { exist.qty++; } else { cart.push(item); }
        localStorage.setItem('cart_v1', JSON.stringify(cart));
        alert("‚úÖ Mahsulot savatga qo'shildi!");
        window.location.href = "savat.html";
      });
    });
  </script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    
    const firebaseConfig = {
      apiKey: "AIzaSyANQB4iORo4rTK5e9Mm-CnwLV14a2wRFBw",
      authDomain: "topmaxsulotmarketuz.firebaseapp.com",
      projectId: "topmaxsulotmarketuz",
      storageBucket: "topmaxsulotmarketuz.firebasestorage.app",
      messagingSenderId: "856799738566",
      appId: "1:856799738566:web:e11409aa25bfb1317975c7",
      measurementId: "G-WM4FELQ9K4"
    };
    // Firebaseni ishga tushirish
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // Elementlarni olamiz
    const loginScreen = document.getElementById('login-screen');
    const siteContent = document.getElementById('site-content');
    const loginBtn = document.getElementById('google-login-btn');
    const loader = document.getElementById('loader');
    
    // Foydalanuvchi ismini chiqarish uchun
    const userDisplayName = document.getElementById('user-display-name');
    const welcomeText = document.getElementById('welcome-text');
    const mobileLogout = document.getElementById('mobile-logout-btn');
    const desktopLogout = document.getElementById('desktop-logout-btn');

    // 1. HOLATNI TEKSHIRISH (Darvozabon)
    onAuthStateChanged(auth, (user) => {
        if (user) {
            // Agar foydalanuvchi kirgan bo'lsa:
            console.log("Foydalanuvchi tizimda: ", user.displayName);
            
            // Login oynasini yo'qotamiz, saytni ochamiz
            loginScreen.style.display = 'none';
            siteContent.style.display = 'block';

            // Ismini saytga yozib qo'yamiz
            userDisplayName.textContent = "üë§ " + user.displayName;
            welcomeText.textContent = "Xush kelibsiz, " + user.displayName + "!";
            
        } else {
            // Agar foydalanuvchi kirmagan bo'lsa:
            console.log("Foydalanuvchi yo'q");
            
            // Login oynasini ko'rsatamiz, saytni yashiramiz
            loginScreen.style.display = 'flex';
            siteContent.style.display = 'none';
        }
    });

    // 2. KIRISH TUGMASI BOSILGANDA
    loginBtn.addEventListener('click', () => {
        loader.style.display = 'block'; // Aylanadigan narsa chiqadi
        loginBtn.style.display = 'none'; // Tugma yo'qoladi

        signInWithPopup(auth, provider)
            .then((result) => {
                // Muvaffaqiyatli o'tdi, onAuthStateChanged o'zi saytni ochadi
            })
            .catch((error) => {
                console.error(error);
                alert("Xatolik: " + error.message);
                loader.style.display = 'none';
                loginBtn.style.display = 'flex';
            });
    });

    // 3. CHIQISH FUNKSIYASI (LOGOUT)
    function logoutUser() {
        if(confirm("Tizimdan chiqmoqchimisiz?")) {
            signOut(auth).then(() => {
                // Chiqib ketganda avtomatik login oynasi qaytib keladi
                alert("Siz tizimdan chiqdingiz!");
            });
        }
    }

    mobileLogout.addEventListener('click', logoutUser);
    desktopLogout.addEventListener('click', logoutUser);

  </script>

</body>
</html>
