<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Savat - TopMaxsulotMarket</title>
  <link rel="icon" type="image/png" href="favicon.png">

  <!-- Tashqi CSS fayl (umumiy uslublar uchun) -->
  <link rel="stylesheet" href="savat.css">

  <!-- Tailwind CSS ‚Äî dizaynni chiroyli qilish uchun -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">

  <!-- === HEADER QISMI === -->
  <header>
    <div  class="logo">
      <img src="logo.png" alt="TopMaxsulotMarket Logotip" width="300">
    </div>
    <nav>
      <ul>
        <li><a href="index.html">üè† Bosh sahifa</a></li>
        <li><a href="katalog.html">‚ò∞ Mahsulotlar katalogi</a></li>
        <li><a href="savat.html">üõíSavat</a></li>
        <li><a href="login.html">üë§Kirish</a></li>
      </ul>
    </nav>
  </header>

  <!-- === ASOSIY KONTENT (SAVAT) === -->
  <main class="max-w-6xl mx-auto p-4 mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
    
    <!-- SAVATDAGI MAHSULOTLAR QISMI -->
    <section id="cart" class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-sm">
      <h1 class="text-black font-semibold mb-4">üõçÔ∏è Savatdagi mahsulotlar</h1>

      <!-- Savatdagi mahsulotlar shu yerda JS orqali yaratiladi -->
      <div id="cart-content"></div>

      <!-- Savat bo‚Äòsh holati -->
      <div id="empty-state" class="hidden text-center py-12">
        <svg class="mx-auto h-20 w-20 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 3h18l-1 14a2 2 0 01-2 2H6a2 2 0 01-2-2L3 3z" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 11V7a4 4 0 00-8 0v4" />
        </svg>
        <h2 class="mt-4 text-lg font-medium">Savat hozircha bo'sh</h2>
        <p class="mt-2 text-sm text-gray-500">Mahsulotlarni katalogdan qo'shing.</p>
        <div class="mt-6">
          <a href="katalog.html" class="inline-block px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Do'konga o'tish</a>
        </div>
      </div>
    </section>

    <!-- BUYURTMA XULOSASI (O‚ÄòNG TOMONDA) -->
    <aside class="bg-white p-6 rounded-2xl shadow-sm">
      <h3 class="text-lg font-medium">Buyurtma xulosasi</h3>

      <div class="mt-4 space-y-3">
        <!-- Umumiy son -->
        <div class="flex justify-between text-sm text-gray-600">
          <span>Mahsulotlar soni</span>
          <span id="items-count">0</span>
        </div>

        <!-- Yetkazib berish -->
        <div class="flex justify-between text-sm text-gray-600">
          <span>Yetkazib berish</span>
          <span id="shipping-text">‚Äî</span>
        </div>

        <!-- Jami summa -->
        <div class="flex justify-between text-base font-semibold">
          <span>Jami</span>
          <span id="subtotal">0 so'm</span>
        </div>

        <!-- Promokod kiritish maydoni -->
        <div class="pt-4 border-t">
          <label for="coupon" class="block text-sm text-gray-700">Promokod</label>
          <div class="mt-2 flex gap-2">
            <input id="coupon" type="text" placeholder="Promokodni kiriting" class="flex-1 px-3 py-2 rounded-lg border" />
            <button id="apply-coupon" class="px-3 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700">Qo'llash</button>
          </div>
          <p id="coupon-msg" class="mt-2 text-sm text-green-600 hidden"></p>
        </div>

        <!-- Tugmalar -->
        <button id="checkout" class="w-full mt-4 px-4 py-3 bg-emerald-600 text-white rounded-lg font-medium hover:bg-emerald-700">
          To'lovga o'tish
        </button>

        <button id="clear-cart" class="w-full mt-2 px-4 py-2 border rounded-lg text-sm text-red-600 hover:bg-red-100">
          Savatni tozalash
        </button>
      </div>
    </aside>
  </main>



  <!-- === JAVASCRIPT QISMI === -->
  <script>
    

    // === Savat holatini localStorage dan olish ===
    let cart = JSON.parse(localStorage.getItem('cart_v1')) || sampleProducts;
    let coupon = null; // promokodlar  uchun holat

    // ===  Pulni formatlash (chiroyli ko'rinishda ko'rsatish uchun) ===
    const money = v => new Intl.NumberFormat('ru-RU').format(v) + " so'm";

    // === 4. Savatni yangilab ko'rsatish funksiyasi ===
    function renderCart() {
      const container = document.getElementById('cart-content');
      const empty = document.getElementById('empty-state');
      container.innerHTML = ''; // eski mahsulotlarni tozalaymiz

      // Agar savat bo'sh bo'lsa
      if (!cart || cart.length === 0) {
        empty.classList.remove('hidden');
        document.getElementById('items-count').innerText = '0';
        document.getElementById('shipping-text').innerText = '‚Äî';
        document.getElementById('subtotal').innerText = '0 so\'m';
        return;
      }

      // Bo'sh holatni yashirish
      empty.classList.add('hidden');

      // Har bir mahsulotni HTML ko‚Äòrinishda chiqarish
      cart.forEach(item => {
        const row = document.createElement('div');
        row.className = 'flex items-center gap-4 py-4 border-b';
        row.innerHTML = `
          <img src="${item.img}" alt="${item.title}" class="w-20 h-20 object-cover rounded-lg">
          <div class="flex-1">
            <div class="flex justify-between items-start">
              <div>
                <h4 class="font-medium">${item.title}</h4>
                <p class="text-sm text-gray-500">Narxi: <span class="font-semibold">${money(item.price)}</span></p>
              </div>
              <button data-id="${item.id}" class="remove text-sm text-red-500 hover:underline">O'chirish</button>
            </div>
            <div class="mt-3 flex items-center gap-3">
              <div class="flex items-center border rounded-lg overflow-hidden">
                <button data-id="${item.id}" class="dec px-3 py-1">‚àí</button>
                <div class="px-4">${item.qty}</div>
                <button data-id="${item.id}" class="inc px-3 py-1">+</button>
              </div>
              <div class="ml-auto font-semibold">${money(item.price * item.qty)}</div>
            </div>
          </div>
        `;
        container.appendChild(row);
      });

      document.getElementById('items-count').innerText = cart.reduce((s,i)=>s+i.qty,0);
      updateTotals();

      // Tugmalarni yangilash
      document.querySelectorAll('.inc').forEach(btn=> btn.addEventListener('click', e=> changeQty(e.target.dataset.id, 1)));
      document.querySelectorAll('.dec').forEach(btn=> btn.addEventListener('click', e=> changeQty(e.target.dataset.id, -1)));
      document.querySelectorAll('.remove').forEach(btn=> btn.addEventListener('click', e=> removeItem(e.target.dataset.id)));

      saveCart();
    }

    // === 5. Miqdorni o‚Äòzgartirish ===
    function changeQty(id, delta) {
      cart = cart.map(it => {
        if (it.id === id) it.qty = Math.max(1, it.qty + delta);
        return it;
      });
      renderCart();
    }

    // === 6. Mahsulotni o‚Äòchirish ===
    function removeItem(id) {
      cart = cart.filter(it => it.id !== id);
      renderCart();
    }

    // === 7. Savatni tozalash ===
    function clearCart() {
      cart = [];
      coupon = null;
      document.getElementById('coupon-msg').classList.add('hidden');
      saveCart();
      renderCart();
    }

    // ===  promokodni qo‚Äòllash ===
    function applyCoupon(code) {
      const codes = { 'SALOM': 0.10, 'TOPMAXSULOT': 0.05 }; // mavjud promokodlar
      const upper = (code || '').toUpperCase().trim();
      const msg = document.getElementById('coupon-msg');

      if (codes[upper]) {
        coupon = { code: upper, discount: codes[upper] };
        msg.classList.remove('hidden');
        msg.innerText = `‚úÖ ${upper} promokod qo'llanildi: ${Math.round(codes[upper]*100)}% chegirma!`;
        msg.classList.add('text-green-600');
      } else {
        msg.classList.remove('hidden');
        msg.classList.add('text-red-600');
        msg.innerText = '‚ùå Noto\'g\'ri promokod';
      }

      updateTotals();
      saveCart();
    }

    // === Jami summani hisoblash ===
    function updateTotals() {
      const subtotalVal = cart.reduce((s,i)=>s + i.price * i.qty, 0);
      const shipping = subtotalVal > 100000 ? 0 : 12000; // 100 mingdan ortiq bo'lsa bepul
      let discount = 0;
      if (coupon) discount = Math.round(subtotalVal * coupon.discount);
      const total = subtotalVal - discount + shipping;

      document.getElementById('subtotal').innerText = money(total);
      document.getElementById('shipping-text').innerText = shipping === 0 ? 'Bepul' : money(shipping);
      document.getElementById('items-count').innerText = cart.reduce((s,i)=>s+i.qty,0);
    }

    // === 10. Ma'lumotni localStorage ga saqlash ===
    function saveCart() {
      localStorage.setItem('cart_v1', JSON.stringify(cart));
    }

    // === 11. Tugmalarni ishga tushirish ===
    document.getElementById('apply-coupon').addEventListener('click', ()=> applyCoupon(document.getElementById('coupon').value));
    document.getElementById('clear-cart').addEventListener('click', clearCart);
    document.getElementById('checkout').addEventListener('click', ()=> {
      if (!cart || cart.length === 0) return alert('Savat bo\'sh. Mahsulot qo\'shing.');
      alert('‚úÖ Buyurtma yuborildi!');
      clearCart();
    });

    // === 12. Boshlang'ich render ===
    renderCart();

    
  </script>
  <br><br><br><br><br><br><br><br>
  <!-- Footer -->
  <footer>
    <p>&copy; 2025 TopMaxsulotMarket. Barcha huquqlar himoyalangan.</p>
  </footer>
</body>
</html>

